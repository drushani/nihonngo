<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥æ–‡å–®å­—å°æ¸¬é©—</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }

        .container {
            margin-top: 80px;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
        }

        h1 {
            text-align: center;
        }

        .question {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .input-container {
            margin-bottom: 20px;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 5px;
        }

        button {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:disabled {
            background-color: #ddd;
        }

        .feedback {
            text-align: center;
            font-size: 18px;
        }

        .next-button {
            background-color: #008CBA;
        }

        .progress-wrapper {
            width: 100%;
            position: fixed;
            top: 0;
            left: 0;
            padding: 10px 20px;
            background-color: #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            z-index: 1000;
            box-sizing: border-box;
        }

        .progress-container {
            width: 100%;
            background-color: #ddd;
            border-radius: 5px;
            overflow: hidden;
            height: 10px;
            margin-bottom: 5px;
        }

        .progress-bar {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s ease;
        }

        #progressText {
            text-align: right;
            font-size: 12px;
            margin: 0;
            color: #555;
        }


    </style>
</head>
<body>

<div class="progress-wrapper">
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    <p id="progressText">0 / 0</p>
</div>
    
<div class="container">
    <h1>æ—¥æ–‡å–®å­—å°æ¸¬é©—</h1>
    <div class="question-container">
        <p class="question">æº–å‚™å¥½äº†å—ï¼Ÿé–‹å§‹ï¼</p>
        
        <div class="input-container">
            <input type="text" id="answer" placeholder="è«‹è¼¸å…¥å¹³å‡å">
        </div>
        <button id="submit" disabled>é€å‡º</button>
        <div class="feedback"></div>
    </div>
</div>

<script>
    const wordBank = {
        "ç´€ä¼ŠåŠå³¶": "ãã„ã¯ã‚“ã¨ã†",
        "è¡£è£…": "ã„ã—ã‚‡ã†",
        "æµ´è¡£": "ã‚†ã‹ãŸ",
        "ä¾å­˜": "ã„ãã‚“",
        "å§”è¨—": "ã„ãŸã",
        "èƒƒè¢‹": "ã„ã¶ãã‚",
        "ç‚ºæ›¿": "ã‹ã‚ã›",
        "å½±éŸ¿": "ãˆã„ãã‚‡ã†",
        "è¡Œç‚º": "ã“ã†ã„",
        "éºè·¡": "ã„ã›ã",
        "é ˜åŸŸ": "ã‚Šã‚‡ã†ã„ã",
        "å®‡å®™": "ã†ã¡ã‚…ã†",
        "ç¾½æ¯›": "ã†ã‚‚ã†",
        "æ „èª‰": "ãˆã„ã‚ˆ",
        "æ „å† ": "ãˆã„ã‹ã‚“",
        "ç¹æ „": "ã¯ã‚“ãˆã„",
        "è¦‹æ „": "ã¿ãˆ",
        "è¦‹æ „ãˆ": "ã¿ã°ãˆ",
        "æ–°é‹­": "ã—ã‚“ãˆã„",
        "è‡ªè¡›éšŠ": "ã˜ãˆã„ãŸã„",
        "æ’®å½±": "ã•ã¤ãˆã„",
        "æº¶æ¶²": "ã‚ˆã†ãˆã",
        "è¾Ÿæ˜“": "ã¸ããˆã",
        "åç›Š": "ã—ã‚…ã†ãˆã",
        "åˆ©ç›Š": "ã‚Šãˆã",
        "æ¶²ä½“": "ãˆããŸã„",
        "æ¶²çŠ¶": "ãˆãã˜ã‚‡ã†",
        "è¡°ãˆã‚‹": "ãŠã¨ã‚ãˆã‚‹",
        "éˆã„": "ã«ã¶ã„",
        "éˆè§’": "ã©ã‚“ã‹ã",
        "æ „ãˆã‚‹": "ã•ã‹ãˆã‚‹",
        "é‹­ã„": "ã™ã‚‹ã©ã„",
        "æ˜“ã—ã„": "ã‚„ã•ã—ã„",
        "è¡£é£Ÿä½": "ã„ã—ã‚‡ãã˜ã‚…ã†",
        "ä¾ç„¶": "ã„ãœã‚“",
        "å§”ä»»": "ã„ã«ã‚“",
        "å‰æ¥­": "ã„ãã‚‡ã†",
        "éºç”£": "ã„ã•ã‚“",
        "èƒƒè…¸": "ã„ã¡ã‚‡ã†",
        "éºä¼": "ã„ã§ã‚“",
        "åŒºåŸŸ": "ãã„ã",
        "äºŒç¾½ãƒ‹ãƒ¯ãƒˆãƒª": "ã«ã‚ã«ã‚ã¨ã‚Š",
        "å…‰æ „": "ã“ã†ãˆã„",
        "æ „é¤Š": "ãˆã„ã‚ˆã†",
        "äº¤æ˜“": "ã“ã†ãˆã",
        "å½±éŸ¿åŠ›": "ãˆã„ãã‚‡ã†ã‚Šã‚‡ã",
        "é‹­åˆ©ãª": "ãˆã„ã‚Šãª",
        "è¡›æ˜Ÿ": "ãˆã„ã›ã„",
        "èƒƒæ¶²": "ã„ãˆã",
        "ç§»å‹•": "ã„ã©ã†",
        "ç•°è­°": "ã„ã",
        "ä»¥ä¸Š": "ã„ã˜ã‚‡ã†",
        "ç•°å¸¸": "ã„ã˜ã‚‡ã†",
        "åŒ»å¸«": "ã„ã—",
        "æ„å¿—": "ã„ã—",
        "å‘¨å›²": "ã—ã‚…ã†ã„",
        "è¡›ç”Ÿ": "ãˆã„ã›ã„",
        "å¾Œéºç—‡": "ã“ã†ã„ã—ã‚‡ã†",
        "å¥½æ„": "ã“ã†ã„",
        "æ›´è¡£å®¤": "ã“ã†ã„ã—ã¤",
        "å‰å¤§ãª": "ã„ã ã„ãª",
        "é•å": "ã„ã¯ã‚“",
        "çµŒç·¯åº¦": "ã‘ã„ã„ã©",
        "ç›¸é•ç‚¹": "ãã†ã„ã¦ã‚“",
        "é•æ³•": "ã„ã»ã†",
        "å‰äºº": "ã„ã˜ã‚“",
        "åŒ—ç·¯": "ã»ãã„",
        "å—ç·¯": "ãªã‚“ã„",
        "é•å’Œæ„Ÿ": "ã„ã‚ã‹ã‚“",
        "è¡£æ–™å“": "ã„ã‚Šã‚‡ã†ã²ã‚“",
        "è¡£æœ": "ã„ãµã",
        "è¡£é¡": "ã„ã‚‹ã„",
        "å…¨åŸŸ": "ãœã‚“ã„ã",
        "æµ·åŸŸ": "ã‹ã„ã„ã",
        "åºƒåŸŸ": "ã“ã†ã„ã",
        "è–åŸŸ": "ã›ã„ã„ã",
        "é¢å½±": "ãŠã‚‚ã‹ã’",
        "äººå½±": "ã²ã¨ã‹ã’",
        "å½±": "ã‹ã’",
        "è­·è¡›": "ã”ãˆã„",
        "å®ˆè¡›": "ã—ã‚…ãˆã„",
        "é˜²è¡›": "ã¼ã†ãˆã„",
        "å®¹æ˜“": "ã‚ˆã†ã„",
        "å®‰æ˜“": "ã‚ã‚“ã„",
        "å¹³æ˜“": "ã¸ã„ã„",
        "ç°¡æ˜“": "ã‹ã‚“ã„"
    };


    const questionContainer = document.querySelector(".question-container");
    const feedbackContainer = document.querySelector(".feedback");
    const submitButton = document.getElementById("submit");
    const answerInput = document.getElementById("answer");

    let remainingWords = Object.entries(wordBank);
    let currentWord = null;
    let attemptCount = 0;
    let score = 0;
    let total = remainingWords.length;
    let wrongList = [];
    let isRetryMode = false;

    function getRandomWord() {
        const randomIndex = Math.floor(Math.random() * remainingWords.length);
        return { index: randomIndex, kanji: remainingWords[randomIndex][0], hiragana: remainingWords[randomIndex][1] };
    }

    function updateQuestion() {
        if (remainingWords.length === 0) {
            showResult();
            return;
        }

        currentWord = getRandomWord();
        document.querySelector(".question").textContent = `${currentWord.kanji} â†’`;
        answerInput.value = '';
        feedbackContainer.textContent = '';
        submitButton.disabled = true;
        attemptCount = 0;

        updateProgressBar();
    }

    function updateProgressBar() {
        const currentProgress = total - remainingWords.length;
        const percent = Math.round((currentProgress / total) * 100);
        document.getElementById("progressBar").style.width = `${percent}%`;
        document.getElementById("progressText").textContent = `${currentProgress} / ${total}`;
    }


    function restartAll() {
        remainingWords = Object.entries(wordBank);
        score = 0;
        total = remainingWords.length;
        wrongList = [];
        isRetryMode = false;
        answerInput.disabled = false;
        submitButton.disabled = true;
        updateQuestion();
        updateProgressBar();
    }

    function showResult() {
        document.querySelector(".question").innerHTML = `ğŸ‰ æ¸¬é©—çµæŸï¼<br>åˆ†æ•¸ï¼š${score} / ${total}`;
        answerInput.disabled = true;
        submitButton.disabled = true;

        let html = "";

        if (wrongList.length > 0) {
            const wrongWordsHtml = wrongList.map(w => `<li>${w.kanji} â†’ ${w.hiragana}</li>`).join('');
            html += `
                <br><strong>éŒ¯èª¤é¡Œç›®ï¼š</strong>
                <ul style="text-align:left">${wrongWordsHtml}</ul>
                <button id="retry" class="next-button" style="margin-top: 10px;">å†æŒ‘æˆ°éŒ¯é¡Œ</button>
            `;
        } else {
            html += `<br>ğŸ¯ å®Œç¾ç„¡èª¤ï¼å¤ªå¼·å•¦ï¼`;
        }

        // âœ… æ–°å¢ã€Œé‡æ–°é–‹å§‹ã€æŒ‰éˆ•
        html += `<br><button id="restart" class="next-button" style="margin-top: 10px; background-color:#f44336;">é‡æ–°é–‹å§‹</button>`;

        feedbackContainer.innerHTML = html;

        if (document.getElementById("retry")) {
            document.getElementById("retry").addEventListener("click", retryWrongQuestions);
        }

        document.getElementById("restart").addEventListener("click", restartAll);
    }

    function retryWrongQuestions() {
        remainingWords = wrongList.map(w => [w.kanji, w.hiragana]);
        wrongList = [];
        score = 0;
        total = remainingWords.length;
        answerInput.disabled = false;
        submitButton.disabled = true;
        isRetryMode = true;
        updateQuestion();
        updateProgressBar();
    }

    function checkAnswer() {
        const userAnswer = answerInput.value.trim();
        if (userAnswer === currentWord.hiragana) {
            feedbackContainer.textContent = "âœ… æ­£ç¢ºï¼";
            feedbackContainer.style.color = "green";
            remainingWords.splice(currentWord.index, 1);
            score++;
            setTimeout(updateQuestion, 800);
        } else {
            attemptCount++;
            if (attemptCount < 3) {
                feedbackContainer.textContent = `âŒ éŒ¯èª¤ï¼Œé‚„æœ‰ ${3 - attemptCount} æ¬¡æ©Ÿæœƒã€‚`;
                feedbackContainer.style.color = "red";
            } else {
                feedbackContainer.innerHTML = `
                    âŒ éŒ¯èª¤ä¸‰æ¬¡ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š<strong>${currentWord.hiragana}</strong><br>
                    <button id="confirm" style="margin-top:10px;" class="next-button">ç¢ºèª</button>
                `;
                feedbackContainer.style.color = "red";

                if (!wrongList.some(w => w.kanji === currentWord.kanji)) {
                    wrongList.push({
                        kanji: currentWord.kanji,
                        hiragana: currentWord.hiragana
                    });
                }

                document.getElementById("confirm").addEventListener("click", () => {
                    remainingWords.splice(currentWord.index, 1);
                    updateQuestion();
                });
            }
        }
    }

    function updateButtonState() {
        submitButton.disabled = !answerInput.value.trim();
    }

    answerInput.addEventListener("input", updateButtonState);
    answerInput.addEventListener("change", updateButtonState);

    answerInput.addEventListener("keydown", function(event) {
        if (event.key === "Enter" && !submitButton.disabled) {
            event.preventDefault();
            checkAnswer();
        }
    });

    submitButton.addEventListener("click", checkAnswer);

    updateQuestion();
    updateButtonState();
</script>

</body>
</html>
