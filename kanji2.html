<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ—¥æ–‡å–®å­—å°æ¸¬é©—</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
    }
    .container {
      margin-top: 80px;
      background-color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      width: 90%;
      max-width: 400px;
    }
    h1 {
      text-align: center;
    }
    .question {
      font-size: 20px;
      margin-bottom: 10px;
    }
    .input-container {
      margin-bottom: 20px;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 5px;
    }
    button {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:disabled {
      background-color: #ddd;
    }
    .feedback {
      text-align: center;
      font-size: 18px;
    }
    .next-button {
      background-color: #008CBA;
    }
    .progress-wrapper {
      width: 100%;
      position: fixed;
      top: 0;
      left: 0;
      padding: 10px 20px;
      background-color: #ffffff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      z-index: 1000;
      box-sizing: border-box;
    }
    .progress-container {
      width: 100%;
      background-color: #ddd;
      border-radius: 5px;
      overflow: hidden;
      height: 10px;
      margin-bottom: 5px;
    }
    .progress-bar {
      height: 100%;
      background-color: #4CAF50;
      width: 0%;
      transition: width 0.3s ease;
    }
    #progressText {
      text-align: right;
      font-size: 12px;
      margin: 0;
      color: #555;
    }
  </style>
</head>
<body>
  <div class="progress-wrapper">
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <p id="progressText">0 / 0</p>
  </div>

  <div class="container">
    <h1>æ—¥æ–‡å–®å­—å°æ¸¬é©—</h1>
    <div class="question-container">
      <p class="question">æº–å‚™å¥½äº†å—ï¼Ÿé–‹å§‹ï¼</p>
      <div class="input-container">
        <input type="text" id="answer" placeholder="è«‹è¼¸å…¥å¹³å‡å">
      </div>
      <button id="submit" disabled>é€å‡º</button>
      <div class="feedback"></div>
    </div>
  </div>

  <script>
    const rawWordBank = {
        "è¶…è¶Š": { hiragana: ["ã¡ã‚‡ã†ãˆã¤"], chinese: "è¶…è¶Š" },
        "è¶Šãˆã‚‹": { hiragana: ["ã“ãˆã‚‹"], chinese: "è¶Šéï¼ˆå…·é«”çš„æ±è¥¿ï¼Œä¾‹å¦‚:æŸµæ¬„æˆ–æ­²æ•¸)" },
        "å£°æ´": { hiragana: ["ã›ã„ãˆã‚“"], chinese: "è²æ´" },
        "ç…™ã„": { hiragana: ["ã‘ã‚€ã„"], chinese: "ç…™éœ§ç€°æ¼«çš„" },
        "ç…™è‰": { hiragana: ["ãŸã°ã“"], chinese: "é¦™ç…™" },
        "ç…™ãŸã„": { hiragana: ["ã‘ã‚€ãŸã„"], chinese: "ç…™éœ§ç€°æ¼«çš„" },
        "æ¡œå‰ç·š": { hiragana: ["ã•ãã‚‰ãœã‚“ã›ã‚“"], chinese: "æ«»èŠ±å‰ç·š" },
        "æ¸›å¡©": { hiragana: ["ã’ã‚“ãˆã‚“"], chinese: "æ¸›é¹½" },
        "å¡©åˆ†": { hiragana: ["ãˆã‚“ã¶ã‚“"], chinese: "é¹½åˆ†" },
        "æ°·æ²³": { hiragana: ["ã²ã‚‡ã†ãŒ"], chinese: "å†°æ²³" },
        "éŠ€æ²³": { hiragana: ["ãã‚“ãŒ"], chinese: "éŠ€æ²³" },
        "è±ªè¯": { hiragana: ["ã”ã†ã‹"], chinese: "è±ªè¯" },
        "é´æ“¦ã‚Œ": { hiragana: ["ãã¤ãšã‚Œ"], chinese: "é‹å­ç£¨è…³" },
        "æˆ‘ãŒã¾ã¾": { hiragana: ["ã‚ãŒã¾ã¾"], chinese: "ä»»æ€§" },
        "æ€ªæˆ‘": { hiragana: ["ã‘ãŒ"], chinese: "å—å‚·" },
        "æˆ‘æ…¢": { hiragana: ["ãŒã¾ã‚“"], chinese: "å¿è€" },
        "å„ä»‹ãª": { hiragana: ["ã‚„ã£ã‹ã„ãª"], chinese: "éº»ç…©çš„" },
        "ä»‹å…¥": { hiragana: ["ã‹ã„ã«ã‚…ã†"], chinese: "ä»‹å…¥" },
        "ä»²ä»‹": { hiragana: ["ã¡ã‚…ã†ã‹ã„"], chinese: "ä»²ä»‹" },
        "åª’ä»‹": { hiragana: ["ã°ã„ã‹ã„"], chinese: "åª’ä»‹" },
        "çš†": { hiragana: ["ã¿ãª"], chinese: "å¤§å®¶" },
        "æ—§è¡—é“": { hiragana: ["ãã‚…ã†ã‹ã„ã©ã†"], chinese: "èˆŠè¡—é“" },
        "ç¥è³€": { hiragana: ["ã—ã‚…ããŒ"], chinese: "ç¥è³€" },
        "å¸‚è¡—": { hiragana: ["ã—ãŒã„"], chinese: "å¸‚å€" },
        "äº’è§’": { hiragana: ["ã”ã‹ã"], chinese: "æ——é¼“ç›¸ç•¶" },
        "æ–¹è§’": { hiragana: ["ã»ã†ãŒã"], chinese: "æ–¹å‘" },
        "æ²³ç«¥": { hiragana: ["ã‹ã£ã±"], chinese: "æ²³ç«¥ï¼ˆæ—¥æœ¬å¦–æ€ªï¼‰" },
        "æ²³å†…": { hiragana: ["ã‹ã‚ã¡"], chinese: "æ²³å…§ï¼ˆäººåï¼‰" },
        "æ²³åŸ": { hiragana: ["ã‹ã‚ã‚‰"], chinese: "æ²³åŸ (åœ°å)" },
        "å¹´è¶Šã—": { hiragana: ["ã¨ã—ã“ã—"], chinese: "è·¨å¹´" },
        "ä»®ã«": { hiragana: ["ã‹ã‚Šã«"], chinese: "å‡å¦‚" },
        "å¿œæ´": { hiragana: ["ãŠã†ãˆã‚“"], chinese: "æ‡‰æ´" },
        "å¡©è¾›ã„": { hiragana: ["ã—ãŠã‹ã‚‰ã„"], chinese: "é¹¹çš„" },
        "é‹æ²³": { hiragana: ["ã†ã‚“ãŒ"], chinese: "é‹æ²³" },
        "ä¸­è¯": { hiragana: ["ã¡ã‚…ã†ã‹"], chinese: "ä¸­è¯" },
        "è¯ã€…ã—ã„": { hiragana: ["ã¯ãªã°ãªã—ã„"], chinese: "è¯éº—çš„" },
        "å’Œè“å­": { hiragana: ["ã‚ãŒã—"], chinese: "å’Œè“å­" },
        "é•·é´": { hiragana: ["ãªãŒãã¤"], chinese: "é•·é´" },
        "æˆ‘ãŒç¤¾": { hiragana: ["ã‚ãŒã—ã‚ƒ"], chinese: "æˆ‘å…¬å¸" },
        "æˆ‘": { hiragana: ["ã‚ã‚Œ"], chinese: "æˆ‘" },
        "è‡ªæˆ‘": { hiragana: ["ã˜ãŒ"], chinese: "è‡ªæˆ‘" },
        "ä»‹æŠ±": { hiragana: ["ã‹ã„ã»ã†"], chinese: "ç…§é¡§ (ç—…äººæˆ–å—å‚·çš„äºº)" },
        "ç°çš¿": { hiragana: ["ã¯ã„ã–ã‚‰"], chinese: "ç…™ç°ç¼¸" },
        "è‡ªå·±ç´¹ä»‹": { hiragana: ["ã˜ã“ã—ã‚‡ã†ã‹ã„"], chinese: "è‡ªæˆ‘ä»‹ç´¹" },
        "è¡—é ­": { hiragana: ["ãŒã„ã¨ã†"], chinese: "è¡—é ­" },
        "ä¸‰è§’å½¢": { hiragana: ["ã•ã‚“ã‹ãã‘ã„"], chinese: "ä¸‰è§’å½¢" },
        "è§’åº¦": { hiragana: ["ã‹ãã©"], chinese: "è§’åº¦" },
        "è§’": { hiragana: ["ã‹ã©", "ã™ã¿", "ã‹ã"], chinese: "è§’ã€è§’è½ã€è§’åº¦" },
        "å¹³ä»®å": { hiragana: ["ã²ã‚‰ãŒãª"], chinese: "å¹³å‡å" },
        "ç‰‡ä»®å": { hiragana: ["ã‹ãŸã‹ãª"], chinese: "ç‰‡å‡å" },
        "é€ã‚Šä»®å": { hiragana: ["ãŠãã‚ŠãŒãª"], chinese: "è¶…ãˆã‚‹çš„ãˆã‚‹" },
        "æŒ¯ã‚Šä»®å": { hiragana: ["ãµã‚ŠãŒãª"], chinese: "æ³¨éŸ³å‡å" },
        "å¼•ã£è¶Šã—": { hiragana: ["ã²ã£ã“ã—"], chinese: "æ¬å®¶" },
        "è¶…ãˆã‚‹": { hiragana: ["ã“ãˆã‚‹"], chinese: "è¶…è¶Šï¼Œä¾‹å¦‚:åº¦æ•¸æˆ–è¶…è¶ŠæŸäºº" },
        "å¢—åŠ ": { hiragana: ["ãã†ã‹"], chinese: "å¢åŠ " },
        "å¯èƒ½æ€§": { hiragana: ["ã‹ã®ã†ã›ã„"], chinese: "å¯èƒ½æ€§" },
        "å®¶æ—": { hiragana: ["ã‹ãã"], chinese: "å®¶æ—" },
        "å¤‰åŒ–": { hiragana: ["ã¸ã‚“ã‹"], chinese: "è®ŠåŒ–" },
        "çµæœ": { hiragana: ["ã‘ã£ã‹"], chinese: "çµæœ" },
        "éå»": { hiragana: ["ã‹ã“"], chinese: "éå»" },
        "ç‰©ä¾¡": { hiragana: ["ã¶ã£ã‹"], chinese: "ç‰©åƒ¹" },
        "ä¸‹é™": { hiragana: ["ã‹ã“ã†"], chinese: "ä¸‹é™" },
        "å¿«æ™´": { hiragana: ["ã‹ã„ã›ã„"], chinese: "æ™´æœ—" },
        "ä¼šå ´": { hiragana: ["ã‹ã„ã˜ã‚‡ã†"], chinese: "æœƒå ´" },
        "æ”¹æ­£": { hiragana: ["ã‹ã„ã›ã„"], chinese: "ä¿®æ­£" },
        "é–‹ä¼š": { hiragana: ["ã‹ã„ã‹ã„"], chinese: "é–‹æœƒ" },
        "èª²é•·": { hiragana: ["ã‹ã¡ã‚‡ã†"], chinese: "èª²é•·" },
        "å›ç­”": { hiragana: ["ã‹ã„ã¨ã†"], chinese: "å›ç­”" },
        "è§£ç­”": { hiragana: ["ã‹ã„ã¨ã†"], chinese: "è§£ç­”" },
        "ä»®æƒ³": { hiragana: ["ã‹ãã†"], chinese: "è™›æ“¬" },
        "ä»®è£…": { hiragana: ["ã‹ãã†"], chinese: "è®Šè£" },
        "ä»®èª¬": { hiragana: ["ã‹ã›ã¤"], chinese: "å‡èªª" },
        "ä»®è¨­": { hiragana: ["ã‹ã›ã¤"], chinese: "è‡¨æ™‚è¨­ç½®" },
        "ä»®å®š": { hiragana: ["ã‹ã¦ã„"], chinese: "å‡å®š" },
        "å®¶åº­": { hiragana: ["ã‹ã¦ã„"], chinese: "å®¶åº­" },
        "éç¨‹": { hiragana: ["ã‹ã¦ã„"], chinese: "éç¨‹" },
        "èª²ç¨‹": { hiragana: ["ã‹ã¦ã„"], chinese: "èª²ç¨‹" },
        "è¡—è§’": { hiragana: ["ã¾ã¡ã‹ã©"], chinese: "è¡—è§’" },
        "å››è§’ã„": { hiragana: ["ã—ã‹ãã„"], chinese: "å››æ–¹å½¢çš„" },
        "å››ã¤è§’": { hiragana: ["ã‚ˆã¤ã‹ã©"], chinese: "åå­—è·¯å£" },
        "é£›ã³è¶Šãˆã‚‹": { hiragana: ["ã¨ã³ã“ãˆã‚‹"], chinese: "è·³é" },
        "æŒã¡è¶Šãˆã‚‹": { hiragana: ["ã‚‚ã¡ã“ãˆã‚‹"], chinese: "å»¶å¾Œ" },
        "å‹ã¡è¶Šã—": { hiragana: ["ã‹ã¡ã“ã—"], chinese: "é ˜å…ˆ" },
        "ä¹—ã‚Šè¶Šã—": { hiragana: ["ã®ã‚Šã“ã—"], chinese: "åéç«™" },
        "è¦‹è¶Šã—": { hiragana: ["ã¿ã“ã—"], chinese: "é è¦‹" },
        "ä¹—ã‚Šè¶Šãˆ": { hiragana: ["ã®ã‚Šã“ãˆ"], chinese: "å…‹æœ" },
        "æ”¯æ´": { hiragana: ["ã—ãˆã‚“"], chinese: "æ”¯æ´" },
        "æ•‘æ´": { hiragana: ["ãã‚…ã†ãˆã‚“"], chinese: "æ•‘æ´" },
        "æ´åŠ©": { hiragana: ["ãˆã‚“ã˜ã‚‡"], chinese: "æ´åŠ©" }
        };

    const wordBank = {};
    for (const [kanji, data] of Object.entries(rawWordBank)) {
      wordBank[kanji] = {
        hiragana: Array.isArray(data.hiragana) ? data.hiragana : [data.hiragana],
        chinese: data.chinese
      };
    }

    const questionContainer = document.querySelector(".question-container");
    const feedbackContainer = document.querySelector(".feedback");
    const submitButton = document.getElementById("submit");
    const answerInput = document.getElementById("answer");

    let remainingWords = Object.entries(wordBank);
    let currentWord = null;
    let score = 0;
    let total = remainingWords.length;
    let wrongList = [];

    function getRandomWord() {
      const randomIndex = Math.floor(Math.random() * remainingWords.length);
      return {
        index: randomIndex,
        kanji: remainingWords[randomIndex][0],
        ...remainingWords[randomIndex][1]
      };
    }

    function updateQuestion() {
      if (remainingWords.length === 0) return showResult();
      currentWord = getRandomWord();
      document.querySelector(".question").innerHTML = `${currentWord.kanji}ï¼ˆ${currentWord.chinese}ï¼‰->`;
      answerInput.value = '';
      feedbackContainer.textContent = '';
      submitButton.disabled = true;
      updateProgressBar();
    }

    function updateProgressBar() {
      const progress = total - remainingWords.length;
      document.getElementById("progressBar").style.width = `${(progress / total) * 100}%`;
      document.getElementById("progressText").textContent = `${progress} / ${total}`;
    }

    function showResult() {
      document.querySelector(".question").innerHTML = `ğŸ‰ æ¸¬é©—çµæŸï¼<br>åˆ†æ•¸ï¼š${score} / ${total}`;
      answerInput.disabled = true;
      submitButton.disabled = true;

      let html = "";
      if (wrongList.length > 0) {
        const list = wrongList.map(w =>
          `<li>${w.kanji} â†’ ${w.hiragana.join(" / ")} (${w.chinese})</li>`
        ).join('');
        html += `
          <br><strong>éŒ¯èª¤é¡Œç›®ï¼š</strong>
          <ul style="text-align:left">${list}</ul>
          <button id="retry" class="next-button" style="margin-top: 10px;">å†æŒ‘æˆ°éŒ¯é¡Œ</button>
        `;
      } else {
        html += `<br>ğŸ¯ å®Œç¾ç„¡èª¤ï¼å¤ªå¼·å•¦ï¼`;
      }

      html += `<br><button id="restart" class="next-button" style="margin-top: 10px; background-color:#f44336;">é‡æ–°é–‹å§‹</button>`;
      feedbackContainer.innerHTML = html;

      if (document.getElementById("retry")) {
        document.getElementById("retry").addEventListener("click", () => {
          remainingWords = wrongList.map(w => [w.kanji, { hiragana: w.hiragana, chinese: w.chinese }]);
          wrongList = [];
          score = 0;
          total = remainingWords.length;
          answerInput.disabled = false;
          submitButton.disabled = true;
          updateQuestion();
        });
      }

      document.getElementById("restart").addEventListener("click", () => location.reload());
    }

    function checkAnswer() {
      const userAnswer = answerInput.value.trim();
      if (currentWord.hiragana.includes(userAnswer)) {
        feedbackContainer.textContent = "âœ… æ­£ç¢ºï¼";
        feedbackContainer.style.color = "green";
        remainingWords.splice(currentWord.index, 1);
        score++;
        setTimeout(updateQuestion, 800);
      } else {
        feedbackContainer.innerHTML = `
          âŒ éŒ¯èª¤ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š<strong>${currentWord.hiragana.join(" / ")}</strong><br>
          <button id="confirm" style="margin-top:10px;" class="next-button">ç¢ºèª</button>
        `;
        feedbackContainer.style.color = "red";
        wrongList.push(currentWord);
        document.getElementById("confirm").addEventListener("click", () => {
          remainingWords.splice(currentWord.index, 1);
          updateQuestion();
        });
      }
    }

    function updateButtonState() {
      submitButton.disabled = !answerInput.value.trim();
    }

    answerInput.addEventListener("input", updateButtonState);
    answerInput.addEventListener("keydown", function (event) {
      if (event.key === "Enter" && !submitButton.disabled) {
        event.preventDefault();
        checkAnswer();
      }
    });

    submitButton.addEventListener("click", checkAnswer);

    updateQuestion();
    updateButtonState();
  </script>
</body>
</html>
