<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ—¥æ–‡å–®å­—å°æ¸¬é©—</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
    }
    .container {
      margin-top: 80px;
      background-color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      width: 90%;
      max-width: 400px;
    }
    h1 {
      text-align: center;
    }
    .question {
      font-size: 20px;
      margin-bottom: 10px;
    }
    .input-container {
      margin-bottom: 20px;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 5px;
    }
    button {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:disabled {
      background-color: #ddd;
    }
    .feedback {
      text-align: center;
      font-size: 18px;
    }
    .next-button {
      background-color: #008CBA;
    }
    .progress-wrapper {
      width: 100%;
      position: fixed;
      top: 0;
      left: 0;
      padding: 10px 20px;
      background-color: #ffffff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      z-index: 1000;
      box-sizing: border-box;
    }
    .progress-container {
      width: 100%;
      background-color: #ddd;
      border-radius: 5px;
      overflow: hidden;
      height: 10px;
      margin-bottom: 5px;
    }
    .progress-bar {
      height: 100%;
      background-color: #4CAF50;
      width: 0%;
      transition: width 0.3s ease;
    }
    #progressText {
      text-align: right;
      font-size: 12px;
      margin: 0;
      color: #555;
    }
  </style>
</head>
<body>
  <div class="progress-wrapper">
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <p id="progressText">0 / 0</p>
  </div>

  <div class="container">
    <h1>æ—¥æ–‡å–®å­—å°æ¸¬é©—</h1>
    <div class="question-container">
      <p class="question">æº–å‚™å¥½äº†å—ï¼Ÿé–‹å§‹ï¼</p>
      <div class="input-container">
        <input type="text" id="answer" placeholder="è«‹è¼¸å…¥å¹³å‡å">
      </div>
      <button id="submit" disabled>é€å‡º</button>
      <div class="feedback"></div>
    </div>
  </div>

  <script>
    const rawWordBank = {
        "è¿‘é ƒ": { hiragana: ["ã¡ã‹ã”ã‚"], chinese: "è¿‘ä¾†" },
        "æ›¸åº—": { hiragana: ["ã—ã‚‡ã¦ã‚“"], chinese: "æ›¸åº—" },
        "å•“ç™º": { hiragana: ["ã‘ã„ã¯ã¤"], chinese: "å•Ÿç™¼" },
        "ç›®ã«ä»˜ã": { hiragana: ["ã‚ã«ã¤ã"], chinese: "é¡¯çœ¼ã€å¼•äººæ³¨ç›®" },
        "é‡è¦è¦–": { hiragana: ["ã˜ã‚…ã†ã‚ˆã†ã—"], chinese: "é‡è¦–" },
        "ç¾ã«": { hiragana: ["ã’ã‚“ã«"], chinese: "å¯¦éš›ä¸Š" },
        "æ·»ãˆã‚‹": { hiragana: ["ããˆã‚‹"], chinese: "é™„åŠ ã€é™„ä¸Š" },
        "æŒ‡ã™": { hiragana: ["ã•ã™"], chinese: "æŒ‡ã€æŒ‡ç¨±" },
        "æ©Ÿé–¢": { hiragana: ["ãã‹ã‚“"], chinese: "æ©Ÿæ§‹ã€æ©Ÿé—œ" },
        "æ›¸ç±": { hiragana: ["ã—ã‚‡ã›ã"], chinese: "æ›¸ç±" },
        "ç›®æ¬¡": { hiragana: ["ã‚‚ãã˜"], chinese: "ç›®éŒ„" },
        "å††æ»‘ãª": { hiragana: ["ãˆã‚“ã‹ã¤ãª"], chinese: "é †åˆ©ã€åœ“æ»‘çš„" },
        "è¤‡æ•°": { hiragana: ["ãµãã™ã†"], chinese: "è¤‡æ•¸" },
        "è©±ã—ä¸Šæ‰‹": { hiragana: ["ã¯ãªã—ã˜ã‚‡ã†ãš"], chinese: "å–„æ–¼èªªè©±çš„äºº" },
        "èãä¸Šæ‰‹": { hiragana: ["ããã˜ã‚‡ã†ãš"], chinese: "å–„æ–¼å‚¾è½çš„äºº" },
        "ï½ãªã„ã—": { hiragana: ["ãªã„ã—"], chinese: "æˆ–" },
        "å€‹ã€…": { hiragana: ["ã“ã“"], chinese: "æ¯ä¸€å€‹" },
        "é¡ã®ãƒ•ãƒ¬ãƒ¼ã‚º": { hiragana: ["ã‚‹ã„ã®ãµã‚Œãƒ¼ãš"], chinese: "é¡ä¼¼çš„ç‰‡èª" },
        "åŒæ–¹å‘": { hiragana: ["ãã†ã»ã†ã“ã†"], chinese: "é›™å‘" },
        "æ„å›³": { hiragana: ["ã„ã¨"], chinese: "æ„åœ–ã€æ‰“ç®—" },
        "é”æˆ": { hiragana: ["ãŸã£ã›ã„"], chinese: "é”æˆ" },
        "èª¤è§£ã‚’è§£ã": { hiragana: ["ã”ã‹ã„ã‚’ã¨ã"], chinese: "è§£é–‹èª¤è§£" },
        "å¿…ãšã—ã‚‚": { hiragana: ["ã‹ãªã‚‰ãšã—ã‚‚"], chinese: "æœªå¿…ã€ä¸ä¸€å®š" },
        "åŒæ–¹": { hiragana: ["ãã†ã»ã†"], chinese: "é›™æ–¹" },
        "ç›¸äº’": { hiragana: ["ãã†ã”"], chinese: "äº’ç›¸" },
        "äº‹æ…‹": { hiragana: ["ã˜ãŸã„"], chinese: "äº‹æ…‹ã€å±€å‹¢" },
        "å ‚ã€…å·¡ã‚Š": { hiragana: ["ã©ã†ã©ã†ã‚ãã‚Š"], chinese: "ç¹åœˆå­ã€ç„¡æ­¢ç›¡åœ°é‡è¤‡" },
        "ä¿®å¾©": { hiragana: ["ã—ã‚…ã†ãµã"], chinese: "ä¿®å¾©" },
        "æˆç†Ÿ": { hiragana: ["ã›ã„ã˜ã‚…ã"], chinese: "æˆç†Ÿ" },
        "éš›é™": { hiragana: ["ã•ã„ã’ã‚“"], chinese: "é™åº¦" },
        "éç¨‹": { hiragana: ["ã‹ã¦ã„"], chinese: "éç¨‹" },
        "å…±åŒ": { hiragana: ["ãã‚‡ã†ã©ã†"], chinese: "å…±åŒ" },
        "æ§˜å¼": { hiragana: ["ã‚ˆã†ã—ã"], chinese: "æ¨£å¼ã€å½¢å¼" },
        "èªè­˜": { hiragana: ["ã«ã‚“ã—ã"], chinese: "èªè­˜" },
        "å…±æœ‰": { hiragana: ["ãã‚‡ã†ã‚†ã†"], chinese: "å…±äº«" },
        "å¹³è¡Œç·š": { hiragana: ["ã¸ã„ã“ã†ã›ã‚“"], chinese: "å¹³è¡Œç·šã€ç„¡äº¤é›†" },
        "å¤–æ¥èª": { hiragana: ["ãŒã„ã‚‰ã„ã”"], chinese: "å¤–ä¾†èª" },
        "æˆç«‹": { hiragana: ["ã›ã„ã‚Šã¤"], chinese: "æˆç«‹" },
        "æ˜æœ": { hiragana: ["ã¿ã‚‡ã†ã¡ã‚‡ã†"], chinese: "æ˜å¤©æ—©ä¸Š" },
        "è¸ã¿å‡ºã™": { hiragana: ["ãµã¿ã ã™"], chinese: "é‚å‡ºã€è¸å‡º" },
        "ã—ã‚Šè¾¼ã¿": { hiragana: ["ã—ã‚Šã”ã¿"], chinese: "é€€ç¸®ã€ç•æ‡¼" },
        "ç€ç”¨": { hiragana: ["ã¡ã‚ƒãã‚ˆã†"], chinese: "ç©¿æˆ´ã€ç¹«ä¸Š(å®‰å…¨å¸¶)" },
        "é–‰é–": { hiragana: ["ã¸ã„ã•"], chinese: "å°é–‰ã€é—œé–‰" },
        "äº†æ‰¿": { hiragana: ["ã‚Šã‚‡ã†ã—ã‚‡ã†"], chinese: "ç†è§£" },
        "æœ€ä½é™": { hiragana: ["ã•ã„ã¦ã„ã’ã‚“"], chinese: "æœ€ä½é™åº¦" },
        "å¯¾å‡¦": { hiragana: ["ãŸã„ã—ã‚‡"], chinese: "è™•ç†ã€æ‡‰å°" },
        "è¦³å¯Ÿ": { hiragana: ["ã‹ã‚“ã•ã¤"], chinese: "è§€å¯Ÿ" },
        "æ¯èª": { hiragana: ["ã¼ã”"], chinese: "æ¯èª" },
        "å¦¨ã’ã‚‹": { hiragana: ["ã•ã¾ãŸã’ã‚‹"], chinese: "å¦¨ç¤™" },
        "è¨€ã„æ›ãˆã‚‹": { hiragana: ["ã„ã„ã‹ãˆã‚‹"], chinese: "æ›å¥è©±èªªã€æ›è¨€ä¹‹" },
        "å…±æ„Ÿ": { hiragana: ["ãã‚‡ã†ã‹ã‚“"], chinese: "å…±é³´ã€ç”¢ç”Ÿå…±é³´" },
        "å¯Ÿã™ã‚‹": { hiragana: ["ã•ã£ã™ã‚‹"], chinese: "å¯Ÿè¦ºã€é«”å¯Ÿ" },
        "åŒåƒš": { hiragana: ["ã©ã†ã‚Šã‚‡ã†"], chinese: "åŒäº‹" },
        "æ€¥ç—…": { hiragana: ["ãã‚…ã†ã³ã‚‡ã†"], chinese: "æ€¥ç—…" },
        "å–å¼•å…ˆ": { hiragana: ["ã¨ã‚Šã²ãã•ã"], chinese: "å®¢æˆ¶ã€äº¤æ˜“å°è±¡" },
        "æ‚ªå£": { hiragana: ["ã‚ã‚‹ãã¡"], chinese: "å£è©±" },
        "ç„¡æ„è­˜": { hiragana: ["ã‚€ã„ã—ã"], chinese: "ç„¡æ„è­˜" },
        "è‡ªä¿¡æº€ã€…": { hiragana: ["ã˜ã—ã‚“ã¾ã‚“ã¾ã‚“"], chinese: "è‡ªä¿¡æ»¿æ»¿" },
        "èº«ã‚’ä¹—ã‚Šå‡ºã™": { hiragana: ["ã¿ã‚’ã®ã‚Šã ã™"], chinese: "æ¢å‡ºèº«é«”ã€ç©æ¥µåƒèˆ‡" },
        "å®Ÿè·µ": { hiragana: ["ã˜ã£ã›ã‚“"], chinese: "å¯¦è¸" }
    };

    const wordBank = {};
    for (const [kanji, data] of Object.entries(rawWordBank)) {
      wordBank[kanji] = {
        hiragana: Array.isArray(data.hiragana) ? data.hiragana : [data.hiragana],
        chinese: data.chinese
      };
    }

    const questionContainer = document.querySelector(".question-container");
    const feedbackContainer = document.querySelector(".feedback");
    const submitButton = document.getElementById("submit");
    const answerInput = document.getElementById("answer");

    let remainingWords = Object.entries(wordBank);
    let currentWord = null;
    let score = 0;
    let total = remainingWords.length;
    let wrongList = [];

    function getRandomWord() {
      const randomIndex = Math.floor(Math.random() * remainingWords.length);
      return {
        index: randomIndex,
        kanji: remainingWords[randomIndex][0],
        ...remainingWords[randomIndex][1]
      };
    }

    function updateQuestion() {
      if (remainingWords.length === 0) return showResult();
      currentWord = getRandomWord();
      document.querySelector(".question").innerHTML = `${currentWord.kanji}ï¼ˆ${currentWord.chinese}ï¼‰->`;
      answerInput.value = '';
      feedbackContainer.textContent = '';
      submitButton.disabled = true;
      updateProgressBar();
    }

    function updateProgressBar() {
      const progress = total - remainingWords.length;
      document.getElementById("progressBar").style.width = `${(progress / total) * 100}%`;
      document.getElementById("progressText").textContent = `${progress} / ${total}`;
    }

    function showResult() {
      document.querySelector(".question").innerHTML = `ğŸ‰ æ¸¬é©—çµæŸï¼<br>åˆ†æ•¸ï¼š${score} / ${total}`;
      answerInput.disabled = true;
      submitButton.disabled = true;

      let html = "";
      if (wrongList.length > 0) {
        const list = wrongList.map(w =>
          `<li>${w.kanji} â†’ ${w.hiragana.join(" / ")} (${w.chinese})</li>`
        ).join('');
        html += `
          <br><strong>éŒ¯èª¤é¡Œç›®ï¼š</strong>
          <ul style="text-align:left">${list}</ul>
          <button id="retry" class="next-button" style="margin-top: 10px;">å†æŒ‘æˆ°éŒ¯é¡Œ</button>
        `;
      } else {
        html += `<br>ğŸ¯ å®Œç¾ç„¡èª¤ï¼å¤ªå¼·å•¦ï¼`;
      }

      html += `<br><button id="restart" class="next-button" style="margin-top: 10px; background-color:#f44336;">é‡æ–°é–‹å§‹</button>`;
      feedbackContainer.innerHTML = html;

      if (document.getElementById("retry")) {
        document.getElementById("retry").addEventListener("click", () => {
          remainingWords = wrongList.map(w => [w.kanji, { hiragana: w.hiragana, chinese: w.chinese }]);
          wrongList = [];
          score = 0;
          total = remainingWords.length;
          answerInput.disabled = false;
          submitButton.disabled = true;
          updateQuestion();
        });
      }

      document.getElementById("restart").addEventListener("click", () => location.reload());
    }

    function checkAnswer() {
      const userAnswer = answerInput.value.trim();
      if (currentWord.hiragana.includes(userAnswer)) {
        feedbackContainer.textContent = "âœ… æ­£ç¢ºï¼";
        feedbackContainer.style.color = "green";
        remainingWords.splice(currentWord.index, 1);
        score++;
        setTimeout(updateQuestion, 800);
      } else {
        feedbackContainer.innerHTML = `
          âŒ éŒ¯èª¤ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š<strong>${currentWord.hiragana.join(" / ")}</strong><br>
          <button id="confirm" style="margin-top:10px;" class="next-button">ç¢ºèª</button>
        `;
        feedbackContainer.style.color = "red";
        wrongList.push(currentWord);
        document.getElementById("confirm").addEventListener("click", () => {
          remainingWords.splice(currentWord.index, 1);
          updateQuestion();
        });
      }
    }

    function updateButtonState() {
      submitButton.disabled = !answerInput.value.trim();
    }

    answerInput.addEventListener("input", updateButtonState);
    answerInput.addEventListener("keydown", function (event) {
      if (event.key === "Enter" && !submitButton.disabled) {
        event.preventDefault();
        checkAnswer();
      }
    });

    submitButton.addEventListener("click", checkAnswer);

    updateQuestion();
    updateButtonState();
  </script>
</body>
</html>
